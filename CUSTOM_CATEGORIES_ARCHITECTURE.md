# 自定义分类架构说明

## 当前实现

### 前端自定义分类（localStorage）
- **存储位置**: 浏览器 localStorage
- **作用范围**: 仅前端筛选
- **数据来源**: 用户手动添加
- **影响**: 只影响前端 UI 的筛选按钮显示

### 后端分类逻辑（config.json）
- **存储位置**: `config.json` 文件
- **作用范围**: 后端数据抓取和分类
- **数据来源**: 配置文件中的关键词匹配
- **影响**: 决定论文的 `tags` 字段

## 关键问题

### ❌ 当前问题

**自定义分类不会影响后端分类逻辑**

- 用户添加的自定义分类（如 "Reinforcement Learning"）只存在于前端
- 后端抓取论文时，仍然只使用 `config.json` 中的关键词来分类
- 如果论文标题/摘要中没有匹配到关键词，就不会被标记为自定义分类
- **结果**: 自定义分类按钮可能显示数量为 0，因为没有论文被标记为该分类

### ✅ 解决方案

有两种方案可以选择：

#### 方案 A: 纯前端分类（推荐，简单）

**原理**: 在前端基于自定义分类的关键词来动态分类论文

**优点**:
- 不需要修改后端代码
- 用户可以随时添加/删除分类
- 不需要重新抓取数据

**缺点**:
- 分类逻辑在前端执行，可能稍慢
- 需要用户为每个自定义分类配置关键词

**实现方式**:
1. 在管理界面中，为每个自定义分类添加关键词配置
2. 前端加载论文后，基于关键词动态添加 tags
3. 筛选时使用这些动态添加的 tags

#### 方案 B: 后端支持自定义分类（复杂）

**原理**: 将自定义分类同步到后端，修改抓取逻辑

**优点**:
- 分类在抓取时完成，性能更好
- 数据一致性更好

**缺点**:
- 需要修改后端代码
- 需要存储自定义分类（KV 或数据库）
- 需要 API 来管理自定义分类
- 需要重新抓取数据才能生效

## 推荐实现：方案 A（前端动态分类）

### 实现步骤

1. **扩展自定义分类数据结构**
   ```javascript
   // 从
   ["Reinforcement Learning"]
   
   // 改为
   [
     {
       name: "Reinforcement Learning",
       keywords: ["reinforcement learning", "RL", "Q-learning", "policy gradient"]
     }
   ]
   ```

2. **前端动态分类函数**
   - 加载论文后，检查每个自定义分类的关键词
   - 如果论文标题/摘要包含关键词，添加对应的 tag

3. **管理界面增强**
   - 添加分类时，同时配置关键词
   - 支持编辑关键词

### 代码修改点

1. `docs/js/main.js`: 
   - 修改 `addCustomCategory` 函数，支持关键词配置
   - 添加 `applyCustomCategoryTags` 函数，动态分类论文
   - 在 `loadMonthData` 后调用动态分类

2. `docs/index.html`:
   - 修改管理界面，添加关键词输入

## 当前状态

**✅ 安全**: 自定义分类不会影响后端抓取逻辑
**⚠️ 限制**: 自定义分类可能无法正确筛选论文（如果没有匹配的关键词）

## 建议

如果希望自定义分类真正生效，建议实现**方案 A（前端动态分类）**，这样：
- 不需要修改后端
- 用户体验更好
- 实现相对简单

